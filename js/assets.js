/*!
 * release-front <https://github.com/nabijaczleweli/release-front>
 * Copyright 2018 nabijaczleweli <https://nabijaczleweli.xyz>
 * Available under MIT license <https://opensource.org/licenses/mit>
 */
(function (global, factory) {
	if (typeof define === "function" && define.amd) {
		define(["exports", "./platform-detect"], factory);
	} else if (typeof exports !== "undefined") {
		factory(exports, require("./platform-detect"));
	} else {
		var mod = {
			exports: {}
		};
		factory(mod.exports, global.platformDetect);
		global.assets = mod.exports;
	}
})(this, function (exports, _platformDetect) {
	"use strict";

	Object.defineProperty(exports, "__esModule", {
		value: true
	});
	exports.rank_assets = rank_assets;


	var PACK_EXTENSIONS = [".tar", ".tgz", ".tgz2", ".tbz2", ".xz", ".zip"];

	var WINDOWS_REGEXES = [/\.exe$/];
	var LINUX_REGEXES = [/\.out$/, /^[^.]+$/];
	var MAC_REGEXES = [/\.dmg$/];

	var MANUAL_REGEX = /man/i;
	var DOCUMENTATION_REGEX = /doc/i;

	var PLATFORMS_REGEXES = {};
	PLATFORMS_REGEXES[_platformDetect.Platform.Windows] = WINDOWS_REGEXES;
	PLATFORMS_REGEXES[_platformDetect.Platform.Linux] = LINUX_REGEXES;
	PLATFORMS_REGEXES[_platformDetect.Platform.Mac] = MAC_REGEXES;

	function rank_assets(project_name, tag_name, assets, platform) {
		if (_platformDetect.Platform.all.indexOf(platform) !== -1 && Array.isArray(assets) && tag_name && project_name) {
			var project_man = MANUAL_REGEX.test(project_name);
			var project_doc = DOCUMENTATION_REGEX.test(project_name);
			var platform_name = _platformDetect.Platform.name(platform);
			var platform_name_regex = new RegExp(platform_name, "i");

			return assets.map(function (data) {
				var data_name_reduced = data.name;
				for (var ext = ""; ext !== undefined; ext = PACK_EXTENSIONS.find(function (_) {
					return data_name_reduced.endsWith(_);
				})) {
					data_name_reduced = data_name_reduced.substr(0, data_name_reduced.length - ext.length);
				}data_name_reduced = data_name_reduced.replace(tag_name, "");
				if (tag_name.startsWith("v")) data_name_reduced = data_name_reduced.replace(tag_name.substr(1), "");

				var score = 0;

				if (PLATFORMS_REGEXES[platform].some(function (_) {
					return _.test(data_name_reduced);
				})) score += 2;

				if (platform_name_regex.test(data_name_reduced)) score += 1;

				if (!project_man && MANUAL_REGEX.test(data_name_reduced)) score -= 1;

				if (!project_doc && DOCUMENTATION_REGEX.test(data_name_reduced)) score -= 1;

				return { score: score, data: data };
			});
		} else return [];
	}
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9hc3NldHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O1NBMkRnQixXLEdBQUEsVzs7O0FBakNoQixLQUFNLGtCQUFrQixDQUFDLE1BQUQsRUFBUyxNQUFULEVBQWlCLE9BQWpCLEVBQTBCLE9BQTFCLEVBQW1DLEtBQW5DLEVBQTBDLE1BQTFDLENBQXhCOztBQUdBLEtBQU0sa0JBQWtCLENBQUMsUUFBRCxDQUF4QjtBQUNBLEtBQU0sZ0JBQWtCLENBQUMsUUFBRCxFQUFXLFNBQVgsQ0FBeEI7QUFDQSxLQUFNLGNBQWtCLENBQUMsUUFBRCxDQUF4Qjs7QUFFQSxLQUFNLGVBQXNCLE1BQTVCO0FBQ0EsS0FBTSxzQkFBc0IsTUFBNUI7O0FBRUEsS0FBTSxvQkFBZ0MsRUFBdEM7QUFDQSxtQkFBa0IseUJBQVMsT0FBM0IsSUFBc0MsZUFBdEM7QUFDQSxtQkFBa0IseUJBQVMsS0FBM0IsSUFBc0MsYUFBdEM7QUFDQSxtQkFBa0IseUJBQVMsR0FBM0IsSUFBc0MsV0FBdEM7O0FBb0JPLFVBQVMsV0FBVCxDQUFxQixZQUFyQixFQUFtQyxRQUFuQyxFQUE2QyxNQUE3QyxFQUFxRCxRQUFyRCxFQUErRDtBQUNyRSxNQUFHLHlCQUFTLEdBQVQsQ0FBYSxPQUFiLENBQXFCLFFBQXJCLE1BQW1DLENBQUMsQ0FBcEMsSUFBeUMsTUFBTSxPQUFOLENBQWMsTUFBZCxDQUF6QyxJQUFrRSxRQUFsRSxJQUE4RSxZQUFqRixFQUErRjtBQUM5RixPQUFJLGNBQXNCLGFBQWEsSUFBYixDQUFrQixZQUFsQixDQUExQjtBQUNBLE9BQUksY0FBc0Isb0JBQW9CLElBQXBCLENBQXlCLFlBQXpCLENBQTFCO0FBQ0EsT0FBSSxnQkFBc0IseUJBQVMsSUFBVCxDQUFjLFFBQWQsQ0FBMUI7QUFDQSxPQUFJLHNCQUFzQixJQUFJLE1BQUosQ0FBVyxhQUFYLEVBQTBCLEdBQTFCLENBQTFCOztBQUVBLFVBQU8sT0FBTyxHQUFQLENBQVcsZ0JBQVE7QUFDekIsUUFBSSxvQkFBb0IsS0FBSyxJQUE3QjtBQUNBLFNBQUksSUFBSSxNQUFNLEVBQWQsRUFBa0IsUUFBUSxTQUExQixFQUFxQyxNQUFNLGdCQUFnQixJQUFoQixDQUFxQjtBQUFBLFlBQUssa0JBQWtCLFFBQWxCLENBQTJCLENBQTNCLENBQUw7QUFBQSxLQUFyQixDQUEzQztBQUNDLHlCQUFvQixrQkFBa0IsTUFBbEIsQ0FBeUIsQ0FBekIsRUFBNEIsa0JBQWtCLE1BQWxCLEdBQTJCLElBQUksTUFBM0QsQ0FBcEI7QUFERCxLQUVBLG9CQUFvQixrQkFBa0IsT0FBbEIsQ0FBMEIsUUFBMUIsRUFBb0MsRUFBcEMsQ0FBcEI7QUFDQSxRQUFHLFNBQVMsVUFBVCxDQUFvQixHQUFwQixDQUFILEVBQ0Msb0JBQW9CLGtCQUFrQixPQUFsQixDQUEwQixTQUFTLE1BQVQsQ0FBZ0IsQ0FBaEIsQ0FBMUIsRUFBOEMsRUFBOUMsQ0FBcEI7O0FBRUQsUUFBSSxRQUFRLENBQVo7O0FBRUEsUUFBRyxrQkFBa0IsUUFBbEIsRUFBNEIsSUFBNUIsQ0FBaUM7QUFBQSxZQUFLLEVBQUUsSUFBRixDQUFPLGlCQUFQLENBQUw7QUFBQSxLQUFqQyxDQUFILEVBQ0MsU0FBUyxDQUFUOztBQUVELFFBQUcsb0JBQW9CLElBQXBCLENBQXlCLGlCQUF6QixDQUFILEVBQ0MsU0FBUyxDQUFUOztBQUVELFFBQUcsQ0FBQyxXQUFELElBQWdCLGFBQWEsSUFBYixDQUFrQixpQkFBbEIsQ0FBbkIsRUFDQyxTQUFTLENBQVQ7O0FBRUQsUUFBRyxDQUFDLFdBQUQsSUFBZ0Isb0JBQW9CLElBQXBCLENBQXlCLGlCQUF6QixDQUFuQixFQUNDLFNBQVMsQ0FBVDs7QUFFRCxXQUFPLEVBQUMsWUFBRCxFQUFRLFVBQVIsRUFBUDtBQUNBLElBdkJNLENBQVA7QUF3QkEsR0E5QkQsTUErQkMsT0FBTyxFQUFQO0FBQ0QiLCJmaWxlIjoic3Rkb3V0Iiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIE1JVCBMaWNlbnNlIChNSVQpXG4vL1xuLy8gQ29weXJpZ2h0IChjKSAyMDE4IG5hYmlqYWN6bGV3ZWxpXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuLy8gY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4vLyBTT0ZUV0FSRS5cblxuXG5pbXBvcnQge1BsYXRmb3JtfSBmcm9tIFwiLi9wbGF0Zm9ybS1kZXRlY3RcIjtcblxuXG5jb25zdCBQQUNLX0VYVEVOU0lPTlMgPSBbXCIudGFyXCIsIFwiLnRnelwiLCBcIi50Z3oyXCIsIFwiLnRiejJcIiwgXCIueHpcIiwgXCIuemlwXCJdO1xuXG4vLyBSZW1lbWJlciB0byB1cGRhdGUgaW4gUkVBRE1FLm1kXG5jb25zdCBXSU5ET1dTX1JFR0VYRVMgPSBbL1xcLmV4ZSQvXTtcbmNvbnN0IExJTlVYX1JFR0VYRVMgICA9IFsvXFwub3V0JC8sIC9eW14uXSskL107XG5jb25zdCBNQUNfUkVHRVhFUyAgICAgPSBbL1xcLmRtZyQvXTtcblxuY29uc3QgTUFOVUFMX1JFR0VYICAgICAgICA9IC9tYW4vaTtcbmNvbnN0IERPQ1VNRU5UQVRJT05fUkVHRVggPSAvZG9jL2k7XG5cbmNvbnN0IFBMQVRGT1JNU19SRUdFWEVTICAgICAgICAgICAgID0ge307XG5QTEFURk9STVNfUkVHRVhFU1tQbGF0Zm9ybS5XaW5kb3dzXSA9IFdJTkRPV1NfUkVHRVhFUztcblBMQVRGT1JNU19SRUdFWEVTW1BsYXRmb3JtLkxpbnV4XSAgID0gTElOVVhfUkVHRVhFUztcblBMQVRGT1JNU19SRUdFWEVTW1BsYXRmb3JtLk1hY10gICAgID0gTUFDX1JFR0VYRVM7XG5cblxuLy8vIFJhbmsgdGhlIHNwZWNpZmllZCBhc3NldHMgYWNjb3JkaW5nIHRvIHRoZWlyIHN1aXRhYmlsaXR5IGZvciB0aGUgc3BlY2lmaWVkIHBsYXRmb3JtIGFuZCBwcm9qZWN0LlxuLy8vXG4vLy8gSWYgYW4gYXNzZXQgbWF0Y2hlcyBvbmUgb2YgdGhlIGV4Y3V0YWJsZSByZWdleGVzIGZvciB0aGUgcGxhdGZvcm0sIGl0J3MgZ3JhbnRlZCAyIHBvaW50cy5cbi8vL1xuLy8vIElmIGFuIGFzc2V0IGNvbnRhaW5zIHRoZSBuYW1lIG9mIHRoZSBwbGF0Zm9ybSwgaXQncyBncmFudGVkIDEgcG9pbnQuXG4vLy9cbi8vLyBJZiBhbiBhc3NldCBtYXRjaGVzIHRoZSBtYW51YWwgcmVnZXggYW5kIHRoZSBwcm9qZWN0IG5hbWUgZG9lcyBub3QsIGl0J3Mgc3Vic3RyYWN0ZWQgMSBwb2ludC5cbi8vL1xuLy8vIElmIGFuIGFzc2V0IG1hdGNoZXMgdGhlIGRvY3VtZW50YXRpb24gcmVnZXggYW5kIHRoZSBwcm9qZWN0IG5hbWUgZG9lcyBub3QsIGl0J3Mgc3Vic3RyYWN0ZWQgMSBwb2ludC5cbi8vL1xuLy8vIEFyZ3VtZW50czpcbi8vLyAgICogYHByb2plY3RfbmFtZWA6IGBzdHJpbmdgIOKAkyB0aGUgbmFtZSBvZiB0aGUgcHJvamVjdCB3L28gdGhlIG93bmVyLFxuLy8vICAgKiBgdGFnX25hbWVgOiBgc3RyaW5nYCDigJMgdGhlIG5hbWUgb2YgdGhlIGN1cnJlbnQgdGFnLFxuLy8vICAgKiBgYXNzZXRzYDogYFtvYmplY3RdYCDigJMgYXJyYXkgb2YgYXNzZXRzIGFjcXVpcmVkIGZyb20gdGhlIEdpdEh1YiBBUEksXG4vLy8gICAqIGBwbGF0Zm9ybWA6IGDiiIggUGxhdGZvcm1gIOKAkyB0aGUgcGxhdGZvcm0gdG8gcmFuayBmb3IuXG4vLy9cbi8vLyBSZXR1cm5zOiBgW29iamVjdF1gOiBge3Njb3JlLCBkYXRhfWAgd2hlcmUgc2NvcmUgaXMgdGhlIHJhbmssIGhpZ2hlciB0aGUgYmV0dGVyLCBhbmQgZGF0YSBpcyB0aGUgb3JpZ2luYWwgYXNzZXQgb2JqZWN0LlxuZXhwb3J0IGZ1bmN0aW9uIHJhbmtfYXNzZXRzKHByb2plY3RfbmFtZSwgdGFnX25hbWUsIGFzc2V0cywgcGxhdGZvcm0pIHtcblx0aWYoUGxhdGZvcm0uYWxsLmluZGV4T2YocGxhdGZvcm0pICE9PSAtMSAmJiBBcnJheS5pc0FycmF5KGFzc2V0cykgJiYgdGFnX25hbWUgJiYgcHJvamVjdF9uYW1lKSB7XG5cdFx0bGV0IHByb2plY3RfbWFuICAgICAgICAgPSBNQU5VQUxfUkVHRVgudGVzdChwcm9qZWN0X25hbWUpO1xuXHRcdGxldCBwcm9qZWN0X2RvYyAgICAgICAgID0gRE9DVU1FTlRBVElPTl9SRUdFWC50ZXN0KHByb2plY3RfbmFtZSk7XG5cdFx0bGV0IHBsYXRmb3JtX25hbWUgICAgICAgPSBQbGF0Zm9ybS5uYW1lKHBsYXRmb3JtKTtcblx0XHRsZXQgcGxhdGZvcm1fbmFtZV9yZWdleCA9IG5ldyBSZWdFeHAocGxhdGZvcm1fbmFtZSwgXCJpXCIpO1xuXG5cdFx0cmV0dXJuIGFzc2V0cy5tYXAoZGF0YSA9PiB7XG5cdFx0XHRsZXQgZGF0YV9uYW1lX3JlZHVjZWQgPSBkYXRhLm5hbWU7XG5cdFx0XHRmb3IobGV0IGV4dCA9IFwiXCI7IGV4dCAhPT0gdW5kZWZpbmVkOyBleHQgPSBQQUNLX0VYVEVOU0lPTlMuZmluZChfID0+IGRhdGFfbmFtZV9yZWR1Y2VkLmVuZHNXaXRoKF8pKSlcblx0XHRcdFx0ZGF0YV9uYW1lX3JlZHVjZWQgPSBkYXRhX25hbWVfcmVkdWNlZC5zdWJzdHIoMCwgZGF0YV9uYW1lX3JlZHVjZWQubGVuZ3RoIC0gZXh0Lmxlbmd0aCk7XG5cdFx0XHRkYXRhX25hbWVfcmVkdWNlZCA9IGRhdGFfbmFtZV9yZWR1Y2VkLnJlcGxhY2UodGFnX25hbWUsIFwiXCIpO1xuXHRcdFx0aWYodGFnX25hbWUuc3RhcnRzV2l0aChcInZcIikpXG5cdFx0XHRcdGRhdGFfbmFtZV9yZWR1Y2VkID0gZGF0YV9uYW1lX3JlZHVjZWQucmVwbGFjZSh0YWdfbmFtZS5zdWJzdHIoMSksIFwiXCIpO1xuXG5cdFx0XHRsZXQgc2NvcmUgPSAwO1xuXG5cdFx0XHRpZihQTEFURk9STVNfUkVHRVhFU1twbGF0Zm9ybV0uc29tZShfID0+IF8udGVzdChkYXRhX25hbWVfcmVkdWNlZCkpKVxuXHRcdFx0XHRzY29yZSArPSAyO1xuXG5cdFx0XHRpZihwbGF0Zm9ybV9uYW1lX3JlZ2V4LnRlc3QoZGF0YV9uYW1lX3JlZHVjZWQpKVxuXHRcdFx0XHRzY29yZSArPSAxO1xuXG5cdFx0XHRpZighcHJvamVjdF9tYW4gJiYgTUFOVUFMX1JFR0VYLnRlc3QoZGF0YV9uYW1lX3JlZHVjZWQpKVxuXHRcdFx0XHRzY29yZSAtPSAxO1xuXG5cdFx0XHRpZighcHJvamVjdF9kb2MgJiYgRE9DVU1FTlRBVElPTl9SRUdFWC50ZXN0KGRhdGFfbmFtZV9yZWR1Y2VkKSlcblx0XHRcdFx0c2NvcmUgLT0gMTtcblxuXHRcdFx0cmV0dXJuIHtzY29yZSwgZGF0YX07XG5cdFx0fSk7XG5cdH0gZWxzZVxuXHRcdHJldHVybiBbXTtcbn1cbiJdfQ==
